---
title: "10x Genomics datasets"
output: html_document
date: "2023-05-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(R.utils)
library(SingleCellExperiment)
library(DropletUtils)
```

## PBMCs

A 10x genomics 3' single cell RNA-seq library generated from [human PBMCs](https://www.10xgenomics.com/resources/datasets/5k-human-pbmcs-3-v3-1-chromium-controller-3-1-standard) will be downloaded from the 10x genomics website. The BAM file and sparseMatrix files generated by cellranger will be downloaded.


```{r}
options("timeout" = 600000)
dir.create("10x", showWarnings = FALSE)

if(!file.exists(file.path("10x", "SC3pv3_GEX_Human_PBMC_possorted_genome_bam.bam"))){
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.1/SC3pv3_GEX_Human_PBMC/SC3pv3_GEX_Human_PBMC_possorted_genome_bam.bam", 
                  file.path("10x", "SC3pv3_GEX_Human_PBMC_possorted_genome_bam.bam"))
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.1/SC3pv3_GEX_Human_PBMC/SC3pv3_GEX_Human_PBMC_possorted_genome_bam.bam.bai", 
                  file.path("10x", "SC3pv3_GEX_Human_PBMC_possorted_genome_bam.bam.bai"))
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.1/SC3pv3_GEX_Human_PBMC/SC3pv3_GEX_Human_PBMC_filtered_feature_bc_matrix.tar.gz",
                   file.path("10x", "SC3pv3_GEX_Human_PBMC_filtered_feature_bc_matrix.tar.gz"))
}

untar(file.path("10x", "SC3pv3_GEX_Human_PBMC_filtered_feature_bc_matrix.tar.gz"), 
      exdir = file.path("10x", "human_pbmc_matrix"))

pbmc.sce <- read10xCounts(file.path("10x", "human_pbmc_matrix", "filtered_feature_bc_matrix"),
                     col.names = TRUE)
save(pbmc.sce, file = "10x/pbmc_sce.rda")
```

## Mouse brain

A 10x genomics 3' single nuclei RNA-seq library generated from [mouse brain](https://www.10xgenomics.com/resources/datasets/5k-adult-mouse-brain-nuclei-isolated-with-chromium-nuclei-isolation-kit-3-1-standard) will be downloaded from the 10x genomics website. The BAM file and sparseMatrix files generated by cellranger will be downloaded.

```{r}

if(!file.exists(file.path("10x", "5k_mouse_brain_CNIK_3pv3_possorted_genome_bam.bam"))){
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.0/5k_mouse_brain_CNIK_3pv3/5k_mouse_brain_CNIK_3pv3_possorted_genome_bam.bam", 
                file.path("10x", "5k_mouse_brain_CNIK_3pv3_possorted_genome_bam.bam"))
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.0/5k_mouse_brain_CNIK_3pv3/5k_mouse_brain_CNIK_3pv3_possorted_genome_bam.bam.bai", 
                file.path("10x", "5k_mouse_brain_CNIK_3pv3_possorted_genome_bam.bam.bai"))
    download.file("https://cf.10xgenomics.com/samples/cell-exp/7.0.0/5k_mouse_brain_CNIK_3pv3/5k_mouse_brain_CNIK_3pv3_filtered_feature_bc_matrix.tar.gz",
                   file.path("10x", "5k_mouse_brain_CNIK_3pv3_filtered_feature_bc_matrix.tar.gz"))
}

untar(file.path("10x", "5k_mouse_brain_CNIK_3pv3_filtered_feature_bc_matrix.tar.gz"), 
      exdir = file.path("10x", "mouse_brain_matrix"))

mb.sce <- read10xCounts(file.path("10x", "mouse_brain_matrix", "filtered_feature_bc_matrix"),
                     col.names = TRUE)
save(mb.sce, file = "10x/mb_sce.rda")
```
s

<details><summary>Show session info</summary>

```{r code}
sessionInfo()
```
</details>
